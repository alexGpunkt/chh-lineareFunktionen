<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>üìê Lineare Funktionen ‚Ä¢ mobil</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0c0f1c;
      --card-bg: rgba(25, 30, 45, 0.95);
      --border: rgba(90, 190, 255, 0.2);
      --accent: #5abfff;
      --accent-glow: rgba(90, 190, 255, 0.3);
      --text: #f0f4ff;
      --text-dim: #a5b3d9;
      --success: #6fcf97;
      --error: #eb5757;
      --radius: 24px;
      --radius-sm: 16px;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 0;
      margin: 0;
    }

    /* Hauptcontainer ‚Äì vollfl√§chig f√ºr mobile */
    .app {
      width: 100%;
      min-height: 100vh;
      background: rgba(15, 20, 30, 0.9);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
    }

    /* Mobile Navigation ‚Äì als Scroll-Leiste unten */
    .mobile-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(10, 15, 25, 0.95);
      backdrop-filter: blur(12px);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0.25rem;
      z-index: 100;
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-size: 0.7rem;
      padding: 0.4rem 0.1rem;
      border-radius: 12px;
      transition: all 0.2s;
      gap: 0.2rem;
    }

    .nav-item span {
      font-size: 1.3rem;
    }

    .nav-item.active {
      color: var(--accent);
      background: rgba(90, 190, 255, 0.15);
    }

    /* Hauptinhalt ‚Äì mit Padding unten f√ºr Navigation */
    .main-content {
      flex: 1;
      padding: 1rem 1rem 5rem 1rem;
      overflow-y: auto;
    }

    /* Hauptbereich ‚Äì vertikale Anordnung f√ºr mobile */
    .main-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Graph-Bereich */
    .graph-area {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1rem;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .graph-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
      color: var(--accent);
      font-weight: 500;
      font-size: 0.9rem;
    }

    .graph-title span {
      background: rgba(90, 190, 255, 0.15);
      padding: 0.2rem 0.8rem;
      border-radius: 40px;
      border: 1px solid var(--border);
    }

    .svg-container {
      background: #0b0f1a;
      border-radius: var(--radius-sm);
      padding: 0.3rem;
      border: 1px solid var(--border);
      margin-bottom: 1rem;
    }

    svg {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 8px;
    }

    /* Funktionsinfos */
    .func-info {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .chip {
      background: rgba(90, 190, 255, 0.1);
      border: 1px solid var(--border);
      border-radius: 60px;
      padding: 0.3rem 0.8rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--accent);
    }

    .chip i {
      color: var(--text-dim);
      font-weight: 400;
      margin-right: 0.3rem;
    }

    /* Rechte Seite ‚Äì untereinander */
    .exercise-area {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .book-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1rem;
      border: 1px solid var(--border);
    }

    .book-card h3 {
      color: var(--accent);
      margin-bottom: 0.8rem;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .book-image {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border);
      background: #05070c;
      padding: 0.3rem;
    }

    .book-image svg {
      width: 100%;
      height: auto;
    }

    .exercise-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1rem;
      border: 1px solid var(--border);
    }

    .exercise-title {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 1rem;
    }

    /* Mobile-optimierte Eingabefelder */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .step-row {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      background: rgba(0, 0, 0, 0.2);
      padding: 0.8rem;
      border-radius: 16px;
      border-left: 3px solid var(--accent);
    }

    .step-label {
      font-weight: bold;
      color: var(--accent);
      font-size: 0.85rem;
    }

    .step-row input {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border);
      border-radius: 30px;
      padding: 0.8rem 1rem;
      color: white;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }

    .step-row .step-hint {
      color: var(--text-dim);
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    /* Tabelle f√ºr mobile */
    .table-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      background: rgba(0, 0, 0, 0.2);
      padding: 0.5rem;
      border-radius: 30px;
    }

    .table-label {
      min-width: 50px;
      font-weight: bold;
    }

    .table-row input {
      flex: 1;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border);
      border-radius: 30px;
      padding: 0.6rem 1rem;
      color: white;
      font-size: 0.95rem;
    }

    /* Buttons ‚Äì gro√ü und gut klickbar */
    .button-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin: 1rem 0 0.5rem;
    }

    .btn {
      background: rgba(90, 190, 255, 0.1);
      border: 1px solid var(--border);
      border-radius: 40px;
      padding: 0.8rem 1.2rem;
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      flex: 1 1 auto;
      min-width: 120px;
    }

    .btn-primary {
      background: rgba(90, 190, 255, 0.3);
      border-color: var(--accent);
    }

    .btn-primary:active {
      background: rgba(90, 190, 255, 0.5);
      transform: scale(0.98);
    }

    .btn:active {
      background: rgba(90, 190, 255, 0.25);
      transform: scale(0.98);
    }

    /* Feedback-Bereich */
    .feedback {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 30px;
      padding: 0.8rem 1rem;
      margin-top: 1rem;
      border-left: 4px solid var(--accent);
      font-size: 0.9rem;
      color: var(--text-dim);
      word-break: break-word;
    }

    .feedback.success {
      border-left-color: var(--success);
      color: #a5e0b5;
    }

    .feedback.error {
      border-left-color: var(--error);
      color: #f5a3a3;
    }

    /* Hide desktop navigation */
    .desktop-nav {
      display: none;
    }

    /* Portrait-optimiert */
    @media (max-width: 480px) {
      .main-content {
        padding: 0.8rem 0.8rem 5rem 0.8rem;
      }
      
      .btn {
        padding: 0.7rem 1rem;
        font-size: 0.9rem;
        min-width: 100px;
      }
      
      .chip {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Mobile Navigation (unten) -->
  <div class="mobile-nav" id="mobileNav">
    <button class="nav-item active" data-section="coords">
      <span>üìå</span>
      <span>Punkte</span>
    </button>
    <button class="nav-item" data-section="table">
      <span>üìä</span>
      <span>Tabelle</span>
    </button>
    <button class="nav-item" data-section="normalform">
      <span>üìà</span>
      <span>m & b</span>
    </button>
    <button class="nav-item" data-section="parallel">
      <span>‚ö°</span>
      <span>Parallel</span>
    </button>
    <button class="nav-item" data-section="nullstellen">
      <span>‚ùå</span>
      <span>Nullstellen</span>
    </button>
  </div>

  <!-- Hauptinhalt (scrollbar) -->
  <div class="main-content" id="mainContent">
    <div class="main-panel" id="mainPanel">
      <!-- Wird per JavaScript bef√ºllt -->
    </div>
  </div>
</div>

<script>
  (function() {
    // ----- Hilfsfunktionen (mathematisch & grafisch) -----
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    function randomSlope() {
      let m;
      do {
        m = rand(-4, 4);
      } while (m === 0);
      return m;
    }

    function asFraction(m) {
      if (Number.isInteger(m)) return m.toString();
      const eps = 0.001;
      for (let den = 1; den <= 8; den++) {
        for (let num = -8; num <= 8; num++) {
          if (Math.abs(m - num / den) < eps) return `${num}/${den}`;
        }
      }
      return m.toFixed(2);
    }

    function computeNullstelle(m, b) {
      if (m === 0) return null;
      return -b / m;
    }

    // Koordinatensystem SVG (mobil-optimiert)
    function renderSVG(m, b, points = [], highlightPoint = null, drawTriangle = false, P = null, nullstelle = null) {
      const xMin = -6, xMax = 6, yMin = -6, yMax = 6;
      const viewBox = `${xMin} ${-yMax} ${xMax - xMin} ${yMax - yMin}`;

      let grid = '';
      for (let x = xMin; x <= xMax; x++) {
        grid += `<line x1="${x}" y1="${-yMin}" x2="${x}" y2="${-yMax}" stroke="#2A3450" stroke-width="0.05" />`;
      }
      for (let y = yMin; y <= yMax; y++) {
        grid += `<line x1="${xMin}" y1="${-y}" x2="${xMax}" y2="${-y}" stroke="#2A3450" stroke-width="0.05" />`;
      }
      grid += `<line x1="0" y1="${-yMin}" x2="0" y2="${-yMax}" stroke="#5ABFFF" stroke-width="0.1" />`;
      grid += `<line x1="${xMin}" y1="0" x2="${xMax}" y2="0" stroke="#5ABFFF" stroke-width="0.1" />`;

      let pointsSvg = '';
      if (points && points.length) {
        points.forEach(p => {
          pointsSvg += `<circle cx="${p.x}" cy="${-p.y}" r="0.25" fill="#FFB347" />`;
        });
      }

      const y1 = m * xMin + b;
      const y2 = m * xMax + b;
      const line = `<line x1="${xMin}" y1="${-y1}" x2="${xMax}" y2="${-y2}" stroke="#5ABFFF" stroke-width="0.15" />`;

      let highlight = '';
      if (highlightPoint) {
        highlight += `<circle cx="${highlightPoint.x}" cy="${-highlightPoint.y}" r="0.3" fill="#EB5757" />`;
      }
      if (P) {
        highlight += `<circle cx="${P.x}" cy="${-P.y}" r="0.3" fill="#EB5757" />`;
      }
      if (nullstelle !== null) {
        const x0 = nullstelle;
        const y0 = 0;
        if (x0 >= xMin && x0 <= xMax) {
          highlight += `<circle cx="${x0}" cy="${-y0}" r="0.35" fill="#EB5757" />`;
          highlight += `<text x="${x0 + 0.3}" y="${-0.3}" fill="#EB5757" font-size="0.5">N</text>`;
        }
      }

      let triangle = '';
      if (drawTriangle && m !== 0) {
        const run = 1;
        const rise = m * run;
        const startX = 0, startY = b;
        const endX = startX + run, endY = startY + rise;
        triangle = `
          <line x1="${startX}" y1="${-startY}" x2="${endX}" y2="${-startY}" stroke="#A5B3D9" stroke-width="0.1" stroke-dasharray="0.2 0.2" />
          <line x1="${endX}" y1="${-startY}" x2="${endX}" y2="${-endY}" stroke="#A5B3D9" stroke-width="0.1" stroke-dasharray="0.2 0.2" />
          <text x="${(startX+endX)/2}" y="${-startY + 0.4}" fill="#A5B3D9" font-size="0.4">1</text>
          <text x="${endX + 0.3}" y="${-(startY+rise/2)}" fill="#A5B3D9" font-size="0.4">${asFraction(m)}</text>
        `;
      }

      return `
        <svg viewBox="${viewBox}" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
          ${grid}
          ${line}
          ${triangle}
          ${pointsSvg}
          ${highlight}
        </svg>
      `;
    }

    // Buch-SVG (mini Visu)
    function bookSVG(type) {
      if (type === 'coords') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><circle cx="30" cy="30" r="3" fill="#FFB347"/><circle cx="70" cy="20" r="3" fill="#FFB347"/><line x1="10" y1="30" x2="90" y2="30" stroke="#5ABFFF" stroke-width="1.5"/><line x1="50" y1="10" x2="50" y2="50" stroke="#5ABFFF" stroke-width="1.5"/></svg>`;
      } else if (type === 'table') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="5" y1="20" x2="95" y2="20" stroke="#5ABFFF"/><line x1="35" y1="5" x2="35" y2="55" stroke="#5ABFFF"/><line x1="65" y1="5" x2="65" y2="55" stroke="#5ABFFF"/><text x="20" y="40" fill="white" font-size="6">x</text><text x="50" y="40" fill="white" font-size="6">y</text><text x="80" y="40" fill="white" font-size="6">y=mx+b</text></svg>`;
      } else if (type === 'normal') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="10" y1="45" x2="90" y2="10" stroke="#5ABFFF" stroke-width="2"/><circle cx="20" cy="40" r="2.5" fill="#FFB347"/><circle cx="45" cy="27.5" r="2.5" fill="#FFB347"/><text x="20" y="15" fill="white" font-size="5">m = rise/run</text></svg>`;
      } else if (type === 'parallel') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="10" y1="40" x2="90" y2="10" stroke="#5ABFFF" stroke-width="2"/><line x1="10" y1="45" x2="90" y2="15" stroke="#EB5757" stroke-width="2"/><circle cx="50" cy="27" r="3" fill="#EB5757"/></svg>`;
      } else {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="15" y1="45" x2="85" y2="15" stroke="#5ABFFF" stroke-width="2"/><circle cx="50" cy="30" r="3" fill="#EB5757"/><text x="45" y="20" fill="white" font-size="5">N</text><text x="20" y="20" fill="white" font-size="4">f(x)=0</text></svg>`;
      }
    }

    // ----- Zustand der App -----
    let currentSection = 'coords';
    let currentExample = null;

    function generateExample(section) {
      if (section === 'coords') {
        const x = rand(-5, 5);
        const y = rand(-5, 5);
        return { target: { x, y } };
      } else if (section === 'table') {
        const m = randomSlope();
        const b = rand(-4, 4);
        const xs = [-2, -1, 0, 1, 2];
        const ys = xs.map(x => m * x + b);
        return { m, b, xs, ys };
      } else if (section === 'normalform') {
        const m = randomSlope();
        const b = rand(-4, 4);
        return { m, b };
      } else if (section === 'parallel') {
        const m = randomSlope();
        const b = rand(-4, 4);
        const P = { x: rand(-3, 3), y: rand(-3, 3) };
        const mPerp = (m !== 0) ? -1 / m : 999;
        const bPar = P.y - m * P.x;
        const bPerp = (m !== 0) ? P.y - mPerp * P.x : 0;
        return { m, b, P, mPerp, bPar, bPerp };
      } else {
        const m = randomSlope();
        const b = rand(-4, 4);
        const nullstelle = computeNullstelle(m, b);
        return { m, b, nullstelle };
      }
    }

    currentExample = generateExample(currentSection);

    function render() {
      const panel = document.getElementById('mainPanel');
      const section = currentSection;
      const ex = currentExample;

      let graphTitle = '';
      let graphSVG = '';
      let funcChips = '';

      if (section === 'coords') {
        graphTitle = 'üìç Punkt finden';
        graphSVG = renderSVG(0, 0, [], ex.target);
        funcChips = `<div class="chip"><i>Gesucht:</i> (${ex.target.x} | ${ex.target.y})</div>`;
      } else if (section === 'table') {
        graphTitle = 'üìä Wertetabelle ‚Üí Graph';
        graphSVG = renderSVG(ex.m, ex.b, ex.xs.map((x, i) => ({ x, y: ex.ys[i] })));
        funcChips = `<div class="chip"><i>y =</i> ${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)}</div>`;
      } else if (section === 'normalform') {
        graphTitle = 'üìà Steigung & Achsenabschnitt';
        graphSVG = renderSVG(ex.m, ex.b, [], null, true);
        funcChips = `<div class="chip"><i>m =</i> ${asFraction(ex.m)}</div><div class="chip"><i>b =</i> ${ex.b}</div>`;
      } else if (section === 'parallel') {
        graphTitle = '‚ö° Parallele & Senkrechte';
        graphSVG = renderSVG(ex.m, ex.b, [], null, false, ex.P);
        funcChips = `<div class="chip"><i>m =</i> ${asFraction(ex.m)}</div><div class="chip"><i>P =</i> (${ex.P.x}|${ex.P.y})</div>`;
      } else {
        graphTitle = '‚ùå Nullstellen berechnen';
        graphSVG = renderSVG(ex.m, ex.b, [], null, false, null, ex.nullstelle);
        funcChips = `<div class="chip"><i>f(x) =</i> ${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)}</div>`;
      }

      let bookType = section;
      let exerciseHTML = '';

      if (section === 'coords') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üéØ</span> Klick-√úbung</div>
            <div class="input-group">
              <input type="text" id="coordsAnswer" placeholder="x, y (z.B. 2,-3)" style="padding:0.8rem;">
            </div>
            <div class="button-group">
              <button class="btn" id="coordsCheckBtn">üñ±Ô∏è Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="coordsFeedback">Gib die Koordinaten des roten Punkts ein.</div>
          </div>
        `;
      } else if (section === 'table') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üìù</span> Tabelle</div>
            <div class="input-group">
              ${ex.xs.map((x, idx) => `
                <div class="table-row">
                  <span class="table-label">x=${x}</span>
                  <input type="text" id="tableInput${idx}" placeholder="y">
                </div>
              `).join('')}
            </div>
            <div class="button-group">
              <button class="btn" id="tableCheckBtn">‚úÖ Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="tableFeedback">Trage die y-Werte ein.</div>
          </div>
        `;
      } else if (section === 'normalform') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üìê</span> m & b bestimmen</div>
            <div class="input-group">
              <input type="text" id="normalM" placeholder="Steigung m (z.B. 2 oder 3/4)">
              <input type="text" id="normalB" placeholder="Achsenabschnitt b">
            </div>
            <div class="button-group">
              <button class="btn" id="normalCheckBtn">üîç Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="normalFeedback">Lies m und b aus dem Graphen ab.</div>
          </div>
        `;
      } else if (section === 'parallel') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>‚ö°</span> Parallel & Senkrecht</div>
            <div class="input-group">
              <input type="text" id="parallelM" placeholder="m‚à• (parallel)">
              <input type="text" id="parallelB" placeholder="b‚à•">
              <input type="text" id="perpM" placeholder="m‚ä• (senkrecht)">
              <input type="text" id="perpB" placeholder="b‚ä•">
            </div>
            <div class="button-group">
              <button class="btn" id="parallelCheckBtn">üîç Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="parallelFeedback">Bestimme die Geraden durch P.</div>
          </div>
        `;
      } else {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>‚ùå</span> Nullstellen Schritt f√ºr Schritt</div>
            <div class="input-group">
              <div class="step-row">
                <span class="step-label">1Ô∏è‚É£ f(x) = 0 setzen</span>
                <input type="text" id="step1" placeholder="z.B. 0 oder f(x)=0">
              </div>
              <div class="step-row">
                <span class="step-label">2Ô∏è‚É£ Funktion einsetzen</span>
                <input type="text" id="step2" placeholder="mx + b = 0">
              </div>
              <div class="step-row">
                <span class="step-label">3Ô∏è‚É£ b auf andere Seite</span>
                <input type="text" id="step3" placeholder="mx = -b">
              </div>
              <div class="step-row">
                <span class="step-label">4Ô∏è‚É£ Durch m dividieren</span>
                <input type="text" id="step4" placeholder="x = -b/m">
              </div>
              <div class="step-row">
                <span class="step-label">5Ô∏è‚É£ Nullstelle</span>
                <input type="text" id="step5" placeholder="x = ...">
              </div>
            </div>
            <div class="button-group">
              <button class="btn" id="nullstellenCheckBtn">üîç Schritte pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="nullstellenFeedback">F√ºlle jeden Schritt aus.</div>
          </div>
        `;
      }

      panel.innerHTML = `
        <div class="graph-area">
          <div class="graph-title">
            <span>${graphTitle}</span>
          </div>
          <div class="svg-container">
            ${graphSVG}
          </div>
          <div class="func-info">
            ${funcChips}
          </div>
        </div>
        <div class="exercise-area">
          <div class="book-card">
            <h3><span>üìñ</span> Buchvorlage</h3>
            <div class="book-image">
              ${bookSVG(bookType)}
            </div>
          </div>
          ${exerciseHTML}
        </div>
      `;

      // Mobile Navigation aktiv setzen
      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.section === currentSection) btn.classList.add('active');
      });

      // Event-Listener
      document.querySelectorAll('#newExampleBtn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          currentExample = generateExample(currentSection);
          render();
        });
      });

      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          currentSection = e.currentTarget.dataset.section;
          currentExample = generateExample(currentSection);
          render();
        });
      });

      // Abschnitts-spezifische Pr√ºfungen
      if (section === 'coords') {
        const checkBtn = document.getElementById('coordsCheckBtn');
        const input = document.getElementById('coordsAnswer');
        const feedback = document.getElementById('coordsFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const val = input.value.trim();
            const parts = val.split(',').map(Number);
            if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
              const [x, y] = parts;
              if (x === ex.target.x && y === ex.target.y) {
                feedback.textContent = '‚úÖ Richtig! Punkt getroffen.';
                feedback.className = 'feedback success';
              } else {
                feedback.textContent = `‚ùå Falsch. Gesucht: (${ex.target.x}|${ex.target.y})`;
                feedback.className = 'feedback error';
              }
            } else {
              feedback.textContent = '‚ùå Format: x,y (z.B. 2,-3)';
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'table') {
        const checkBtn = document.getElementById('tableCheckBtn');
        const feedback = document.getElementById('tableFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            let allCorrect = true;
            for (let i = 0; i < ex.xs.length; i++) {
              const inp = document.getElementById(`tableInput${i}`);
              if (inp) {
                const val = parseFloat(inp.value.replace(',', '.'));
                if (isNaN(val) || Math.abs(val - ex.ys[i]) > 0.01) {
                  allCorrect = false;
                  inp.style.borderColor = '#EB5757';
                } else {
                  inp.style.borderColor = '#6FCF97';
                }
              }
            }
            if (allCorrect) {
              feedback.textContent = '‚úÖ Tabelle richtig!';
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = '‚ùå Nicht alle Werte stimmen.';
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'normalform') {
        const checkBtn = document.getElementById('normalCheckBtn');
        const mInp = document.getElementById('normalM');
        const bInp = document.getElementById('normalB');
        const feedback = document.getElementById('normalFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const mVal = parseFloat(mInp.value.replace(',', '.'));
            const bVal = parseFloat(bInp.value.replace(',', '.'));
            if (!isNaN(mVal) && !isNaN(bVal) && Math.abs(mVal - ex.m) < 0.01 && Math.abs(bVal - ex.b) < 0.01) {
              feedback.textContent = `‚úÖ Korrekt! m = ${asFraction(ex.m)}, b = ${ex.b}`;
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = `‚ùå Falsch. Tipp: m = ${asFraction(ex.m)}, b = ${ex.b}`;
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'parallel') {
        const checkBtn = document.getElementById('parallelCheckBtn');
        const mInp = document.getElementById('parallelM');
        const bInp = document.getElementById('parallelB');
        const mPerpInp = document.getElementById('perpM');
        const bPerpInp = document.getElementById('perpB');
        const feedback = document.getElementById('parallelFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const mPar = parseFloat(mInp.value.replace(',', '.'));
            const bPar = parseFloat(bInp.value.replace(',', '.'));
            const mPerp = parseFloat(mPerpInp.value.replace(',', '.'));
            const bPerp = parseFloat(bPerpInp.value.replace(',', '.'));

            let parOK = !isNaN(mPar) && !isNaN(bPar) && Math.abs(mPar - ex.m) < 0.01 && Math.abs(bPar - ex.bPar) < 0.01;
            let perpOK = !isNaN(mPerp) && !isNaN(bPerp) && Math.abs(mPerp - ex.mPerp) < 0.01 && Math.abs(bPerp - ex.bPerp) < 0.01;

            if (parOK && perpOK) {
              feedback.textContent = `‚úÖ Richtig!`;
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = `‚ùå Nicht korrekt.`;
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'nullstellen') {
        const checkBtn = document.getElementById('nullstellenCheckBtn');
        const feedback = document.getElementById('nullstellenFeedback');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        const step5 = document.getElementById('step5');

        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const expected1 = '0';
            const expected2 = `${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)} = 0`;
            const expected3 = `${asFraction(ex.m)}x = ${-ex.b}`;
            const expected4 = `x = ${asFraction(-ex.b)} / ${asFraction(ex.m)}`;
            const expected5 = ex.nullstelle !== null ? `x = ${ex.nullstelle.toFixed(2)}` : 'keine Nullstelle';

            const val1 = step1.value.trim();
            const step1OK = val1 === '0' || val1 === 'f(x)=0' || val1 === 'f(x) = 0';
            
            const val2 = step2.value.trim().replace(/\s+/g, '');
            const expected2clean = expected2.replace(/\s+/g, '');
            const step2OK = val2 === expected2clean || (val2.includes(`${asFraction(ex.m)}x`) && val2.includes('=0'));
            
            const val3 = step3.value.trim().replace(/\s+/g, '');
            const expected3clean = expected3.replace(/\s+/g, '');
            const step3OK = val3 === expected3clean || (val3.includes(`${asFraction(ex.m)}x=`) && val3.includes(`${-ex.b}`));
            
            const val4 = step4.value.trim().replace(/\s+/g, '');
            const expected4clean = expected4.replace(/\s+/g, '');
            const step4OK = val4 === expected4clean || (val4.includes('x=') && val4.includes('/'));
            
            const val5 = step5.value.trim();
            let step5OK = false;
            if (ex.nullstelle !== null) {
              step5OK = val5.includes(ex.nullstelle.toFixed(2)) || val5.includes(asFraction(ex.nullstelle));
            } else {
              step5OK = val5.toLowerCase().includes('keine') || val5.includes('unendlich');
            }

            step1.style.borderColor = step1OK ? '#6FCF97' : '#EB5757';
            step2.style.borderColor = step2OK ? '#6FCF97' : '#EB5757';
            step3.style.borderColor = step3OK ? '#6FCF97' : '#EB5757';
            step4.style.borderColor = step4OK ? '#6FCF97' : '#EB5757';
            step5.style.borderColor = step5OK ? '#6FCF97' : '#EB5757';

            if (step1OK && step2OK && step3OK && step4OK && step5OK) {
              feedback.textContent = `‚úÖ Alle Schritte korrekt!`;
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = `‚ùå Einige Schritte nicht korrekt.`;
              feedback.className = 'feedback error';
            }
          });
        }
      }
    }

    render();
  })();
</script>
</body>
</html>
