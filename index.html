<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìê Lineare Funktionen ‚Ä¢ visualisiert & interaktiv</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0c0f1c;
      --card-bg: rgba(25, 30, 45, 0.9);
      --border: rgba(90, 190, 255, 0.2);
      --accent: #5abfff;
      --accent-glow: rgba(90, 190, 255, 0.3);
      --text: #f0f4ff;
      --text-dim: #a5b3d9;
      --success: #6fcf97;
      --error: #eb5757;
      --radius: 28px;
      --radius-sm: 18px;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    /* Hauptcontainer ‚Äì wie ein gro√ües grafisches Panel */
    .app {
      max-width: 1400px;
      width: 100%;
      background: rgba(15, 20, 30, 0.7);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 2rem 2rem 2rem 2rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(90, 190, 255, 0.1) inset;
    }

    /* Kopfzeile mit Navigation ‚Äì sehr reduziert im Text, Fokus auf Icons/Symbole */
    .top-bar {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 2.5rem;
      border-bottom: 1px solid var(--border);
      padding-bottom: 1.5rem;
    }

    .nav-btn {
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-size: 1rem;
      padding: 0.75rem 1.5rem;
      border-radius: 60px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .nav-btn span {
      font-size: 1.4rem;
    }

    .nav-btn:hover {
      background: rgba(90, 190, 255, 0.1);
      color: white;
    }

    .nav-btn.active {
      background: rgba(90, 190, 255, 0.2);
      color: white;
      border-color: var(--accent);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    /* Hauptbereich ‚Äì hier passiert die ganze Magie */
    .main-panel {
      display: grid;
      grid-template-columns: 1.2fr 0.9fr;
      gap: 1.8rem;
    }

    /* Linke Seite: immer der Graph & gro√üe Interaktion */
    .graph-area {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .graph-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      color: var(--accent);
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .graph-title span {
      background: rgba(90, 190, 255, 0.15);
      padding: 0.3rem 1rem;
      border-radius: 40px;
      font-size: 0.9rem;
      border: 1px solid var(--border);
    }

    .svg-container {
      background: #0b0f1a;
      border-radius: var(--radius-sm);
      padding: 0.5rem;
      border: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }

    svg {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 12px;
    }

    /* Infos zur aktuellen Funktion ‚Äì sehr grafisch mit Farben */
    .func-info {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .chip {
      background: rgba(90, 190, 255, 0.1);
      border: 1px solid var(--border);
      border-radius: 60px;
      padding: 0.5rem 1.2rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--accent);
      backdrop-filter: blur(4px);
    }

    .chip i {
      color: var(--text-dim);
      font-weight: 400;
      margin-right: 0.5rem;
    }

    /* Rechte Seite: √úbungen & Buch-Bild ‚Äì alles visuell */
    .exercise-area {
      display: flex;
      flex-direction: column;
      gap: 1.8rem;
    }

    .book-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
      text-align: center;
    }

    .book-card h3 {
      color: var(--accent);
      margin-bottom: 1rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .book-image {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border);
      background: #05070c;
      padding: 0.5rem;
    }

    .book-image svg {
      width: 100%;
      height: auto;
    }

    .exercise-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
    }

    .exercise-title {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      margin-bottom: 1.2rem;
      color: var(--accent);
      font-size: 1.2rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.2rem;
    }

    .step-row {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.8rem;
      border-radius: 60px;
      border-left: 3px solid var(--accent);
    }

    .step-label {
      min-width: 40px;
      font-weight: bold;
      color: var(--accent);
    }

    .step-row input {
      flex: 2;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border);
      border-radius: 60px;
      padding: 0.6rem 1.2rem;
      color: white;
      font-size: 0.95rem;
      outline: none;
    }

    .step-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .step-row .step-hint {
      flex: 1;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    .input-group input {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--border);
      border-radius: 60px;
      padding: 0.8rem 1.2rem;
      color: white;
      font-size: 1rem;
      outline: none;
    }

    .input-group input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .button-group {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      margin: 1.5rem 0 0.5rem;
    }

    .btn {
      background: rgba(90, 190, 255, 0.1);
      border: 1px solid var(--border);
      border-radius: 60px;
      padding: 0.6rem 1.4rem;
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .btn-primary {
      background: rgba(90, 190, 255, 0.3);
      border-color: var(--accent);
    }

    .btn-primary:hover {
      background: rgba(90, 190, 255, 0.5);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .btn:hover {
      background: rgba(90, 190, 255, 0.25);
    }

    .feedback {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 60px;
      padding: 0.8rem 1.2rem;
      margin-top: 1rem;
      border-left: 4px solid var(--accent);
      font-size: 0.95rem;
      color: var(--text-dim);
    }

    .feedback.success {
      border-left-color: var(--success);
      color: #a5e0b5;
    }

    .feedback.error {
      border-left-color: var(--error);
      color: #f5a3a3;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 1rem 0;
    }

    @media (max-width: 1000px) {
      .main-panel {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Obere Navigation: nur Icons + kurze Begriffe -->
  <div class="top-bar">
    <button class="nav-btn active" data-section="coords"><span>üìå</span> Punkte</button>
    <button class="nav-btn" data-section="table"><span>üìä</span> Tabelle</button>
    <button class="nav-btn" data-section="normalform"><span>üìà</span> m & b</button>
    <button class="nav-btn" data-section="parallel"><span>‚ö°</span> Parallel</button>
    <button class="nav-btn" data-section="nullstellen"><span>‚ùå</span> Nullstellen</button>
  </div>

  <!-- Dynamischer Hauptbereich -->
  <div class="main-panel" id="mainPanel">
    <!-- Wird per JavaScript bef√ºllt -->
  </div>
</div>

<script>
  (function() {
    // ----- Hilfsfunktionen (mathematisch & grafisch) -----
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    // Zuf√§llige Steigung (nicht 0, nicht zu extrem)
    function randomSlope() {
      let m;
      do {
        m = rand(-4, 4);
      } while (m === 0);
      return m;
    }

    // Bruch-Darstellung f√ºr nice Anzeige
    function asFraction(m) {
      if (Number.isInteger(m)) return m.toString();
      const eps = 0.001;
      for (let den = 1; den <= 8; den++) {
        for (let num = -8; num <= 8; num++) {
          if (Math.abs(m - num / den) < eps) return `${num}/${den}`;
        }
      }
      return m.toFixed(2);
    }

    // Nullstelle berechnen
    function computeNullstelle(m, b) {
      if (m === 0) return null; // keine oder unendlich viele
      return -b / m;
    }

    // Koordinatensystem SVG (achte auf korrekte y-Ausrichtung)
    function renderSVG(m, b, points = [], highlightPoint = null, drawTriangle = false, P = null, nullstelle = null) {
      const xMin = -6, xMax = 6, yMin = -6, yMax = 6;
      const viewBox = `${xMin} ${-yMax} ${xMax - xMin} ${yMax - yMin}`; // y-Achse flipped f√ºr SVG

      // Gitterlinien
      let grid = '';
      for (let x = xMin; x <= xMax; x++) {
        grid += `<line x1="${x}" y1="${-yMin}" x2="${x}" y2="${-yMax}" stroke="#2A3450" stroke-width="0.05" />`;
      }
      for (let y = yMin; y <= yMax; y++) {
        grid += `<line x1="${xMin}" y1="${-y}" x2="${xMax}" y2="${-y}" stroke="#2A3450" stroke-width="0.05" />`;
      }
      // Achsen
      grid += `<line x1="0" y1="${-yMin}" x2="0" y2="${-yMax}" stroke="#5ABFFF" stroke-width="0.1" />`;
      grid += `<line x1="${xMin}" y1="0" x2="${xMax}" y2="0" stroke="#5ABFFF" stroke-width="0.1" />`;

      // Punkte (werden in mathematischen Koordinaten erwartet, f√ºr SVG y negieren)
      let pointsSvg = '';
      if (points && points.length) {
        points.forEach(p => {
          pointsSvg += `<circle cx="${p.x}" cy="${-p.y}" r="0.25" fill="#FFB347" />`;
        });
      }

      // Gerade: zwei Punkte berechnen
      const y1 = m * xMin + b;
      const y2 = m * xMax + b;
      const line = `<line x1="${xMin}" y1="${-y1}" x2="${xMax}" y2="${-y2}" stroke="#5ABFFF" stroke-width="0.15" />`;

      // Highlight (roter Punkt) f√ºr spezielle Punkte (z.B. P oder Nullstelle)
      let highlight = '';
      if (highlightPoint) {
        highlight += `<circle cx="${highlightPoint.x}" cy="${-highlightPoint.y}" r="0.3" fill="#EB5757" />`;
      }
      if (P) {
        highlight += `<circle cx="${P.x}" cy="${-P.y}" r="0.3" fill="#EB5757" />`;
      }
      if (nullstelle !== null) {
        const x0 = nullstelle;
        const y0 = 0;
        if (x0 >= xMin && x0 <= xMax) {
          highlight += `<circle cx="${x0}" cy="${-y0}" r="0.35" fill="#EB5757" />`;
          // Beschriftung
          highlight += `<text x="${x0 + 0.3}" y="${-0.3}" fill="#EB5757" font-size="0.5">N</text>`;
        }
      }

      // Steigungsdreieck (optional)
      let triangle = '';
      if (drawTriangle && m !== 0) {
        const run = 1; // nach rechts
        const rise = m * run;
        const startX = 0, startY = b;
        const endX = startX + run, endY = startY + rise;
        // Dreieck als gestrichelte Linien
        triangle = `
          <line x1="${startX}" y1="${-startY}" x2="${endX}" y2="${-startY}" stroke="#A5B3D9" stroke-width="0.1" stroke-dasharray="0.2 0.2" />
          <line x1="${endX}" y1="${-startY}" x2="${endX}" y2="${-endY}" stroke="#A5B3D9" stroke-width="0.1" stroke-dasharray="0.2 0.2" />
          <text x="${(startX+endX)/2}" y="${-startY + 0.4}" fill="#A5B3D9" font-size="0.4">1</text>
          <text x="${endX + 0.3}" y="${-(startY+rise/2)}" fill="#A5B3D9" font-size="0.4">${asFraction(m)}</text>
        `;
      }

      return `
        <svg viewBox="${viewBox}" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
          <!-- Gitter und Achsen -->
          ${grid}
          <!-- Gerade -->
          ${line}
          <!-- Steigungsdreieck -->
          ${triangle}
          <!-- Punkte -->
          ${pointsSvg}
          <!-- Highlight (roter Punkt) -->
          ${highlight}
        </svg>
      `;
    }

    // Buch-SVG (mini Visu)
    function bookSVG(type) {
      if (type === 'coords') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><circle cx="30" cy="30" r="3" fill="#FFB347"/><circle cx="70" cy="20" r="3" fill="#FFB347"/><line x1="10" y1="30" x2="90" y2="30" stroke="#5ABFFF" stroke-width="1.5"/><line x1="50" y1="10" x2="50" y2="50" stroke="#5ABFFF" stroke-width="1.5"/></svg>`;
      } else if (type === 'table') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="5" y1="20" x2="95" y2="20" stroke="#5ABFFF"/><line x1="35" y1="5" x2="35" y2="55" stroke="#5ABFFF"/><line x1="65" y1="5" x2="65" y2="55" stroke="#5ABFFF"/><text x="20" y="40" fill="white" font-size="6">x</text><text x="50" y="40" fill="white" font-size="6">y</text><text x="80" y="40" fill="white" font-size="6">y=mx+b</text></svg>`;
      } else if (type === 'normal') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="10" y1="45" x2="90" y2="10" stroke="#5ABFFF" stroke-width="2"/><circle cx="20" cy="40" r="2.5" fill="#FFB347"/><circle cx="45" cy="27.5" r="2.5" fill="#FFB347"/><text x="20" y="15" fill="white" font-size="5">m = rise/run</text></svg>`;
      } else if (type === 'parallel') {
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="10" y1="40" x2="90" y2="10" stroke="#5ABFFF" stroke-width="2"/><line x1="10" y1="45" x2="90" y2="15" stroke="#EB5757" stroke-width="2"/><circle cx="50" cy="27" r="3" fill="#EB5757"/></svg>`;
      } else { // nullstellen
        return `<svg viewBox="0 0 100 60"><rect x="5" y="5" width="90" height="50" fill="#1E2639" rx="8" /><line x1="15" y1="45" x2="85" y2="15" stroke="#5ABFFF" stroke-width="2"/><circle cx="50" cy="30" r="3" fill="#EB5757"/><text x="45" y="20" fill="white" font-size="5">N</text><text x="20" y="20" fill="white" font-size="4">f(x)=0</text></svg>`;
      }
    }

    // ----- Zustand der App -----
    let currentSection = 'coords';
    let currentExample = null;

    // Funktion zum Generieren eines Beispiels je nach Sektion
    function generateExample(section) {
      if (section === 'coords') {
        const x = rand(-5, 5);
        const y = rand(-5, 5);
        return { target: { x, y } };
      } else if (section === 'table') {
        const m = randomSlope();
        const b = rand(-4, 4);
        const xs = [-2, -1, 0, 1, 2];
        const ys = xs.map(x => m * x + b);
        return { m, b, xs, ys };
      } else if (section === 'normalform') {
        const m = randomSlope();
        const b = rand(-4, 4);
        return { m, b };
      } else if (section === 'parallel') {
        const m = randomSlope();
        const b = rand(-4, 4);
        const P = { x: rand(-3, 3), y: rand(-3, 3) };
        const mPerp = (m !== 0) ? -1 / m : 999; // bei m=0 Sonderfall
        const bPar = P.y - m * P.x;
        const bPerp = (m !== 0) ? P.y - mPerp * P.x : 0;
        return { m, b, P, mPerp, bPar, bPerp };
      } else { // nullstellen
        const m = randomSlope();
        const b = rand(-4, 4);
        const nullstelle = computeNullstelle(m, b);
        return { m, b, nullstelle };
      }
    }

    // Initiales Beispiel
    currentExample = generateExample(currentSection);

    // ----- Render-Funktion: Baut UI komplett neu -----
    function render() {
      const panel = document.getElementById('mainPanel');
      const section = currentSection;
      const ex = currentExample;

      // Linke Seite (Graph) ist immer √§hnlich, aber mit Variationen
      let graphTitle = '';
      let graphSVG = '';
      let funcChips = '';

      if (section === 'coords') {
        graphTitle = 'üìç Punkt finden';
        graphSVG = renderSVG(0, 0, [], ex.target); // nur Koordinatensystem + Zielpunkt rot
        funcChips = `<div class="chip"><i>Gesucht:</i> (${ex.target.x} | ${ex.target.y})</div>`;
      } else if (section === 'table') {
        graphTitle = 'üìä Wertetabelle ‚Üí Graph';
        graphSVG = renderSVG(ex.m, ex.b, ex.xs.map((x, i) => ({ x, y: ex.ys[i] })));
        funcChips = `<div class="chip"><i>y =</i> ${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)}</div>`;
      } else if (section === 'normalform') {
        graphTitle = 'üìà Steigung & Achsenabschnitt';
        graphSVG = renderSVG(ex.m, ex.b, [], null, true); // mit Dreieck
        funcChips = `<div class="chip"><i>m =</i> ${asFraction(ex.m)}</div><div class="chip"><i>b =</i> ${ex.b}</div>`;
      } else if (section === 'parallel') {
        graphTitle = '‚ö° Parallele & Senkrechte';
        graphSVG = renderSVG(ex.m, ex.b, [], null, false, ex.P);
        funcChips = `<div class="chip"><i>m =</i> ${asFraction(ex.m)}</div><div class="chip"><i>P =</i> (${ex.P.x}|${ex.P.y})</div>`;
      } else { // nullstellen
        graphTitle = '‚ùå Nullstellen berechnen';
        graphSVG = renderSVG(ex.m, ex.b, [], null, false, null, ex.nullstelle);
        funcChips = `<div class="chip"><i>f(x) =</i> ${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)}</div>`;
      }

      // Rechte Seite: Buch + √úbung
      let bookType = section;
      let exerciseHTML = '';

      if (section === 'coords') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üéØ</span> Klick-√úbung</div>
            <div class="input-group">
              <input type="text" id="coordsAnswer" placeholder="x, y eingaben (z.B. 2,-3)">
            </div>
            <div class="button-group">
              <button class="btn" id="coordsCheckBtn">üñ±Ô∏è Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neues Beispiel</button>
            </div>
            <div class="feedback" id="coordsFeedback">Gib die Koordinaten des roten Punkts ein.</div>
          </div>
        `;
      } else if (section === 'table') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üìù</span> Tabelle vervollst√§ndigen</div>
            <div class="input-group">
              ${ex.xs.map((x, idx) => `
                <div style="display: flex; gap:0.3rem; align-items:center; margin-bottom:0.3rem;">
                  <span style="width:2rem;">x=${x}</span>
                  <input type="text" id="tableInput${idx}" placeholder="y" style="width:70px;">
                </div>
              `).join('')}
            </div>
            <div class="button-group">
              <button class="btn" id="tableCheckBtn">‚úÖ Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="tableFeedback">Trage die y-Werte ein (y = m¬∑x + b).</div>
          </div>
        `;
      } else if (section === 'normalform') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>üìê</span> m & b bestimmen</div>
            <div class="input-group">
              <input type="text" id="normalM" placeholder="Steigung m (z.B. 2 oder 3/4)">
              <input type="text" id="normalB" placeholder="Achsenabschnitt b">
            </div>
            <div class="button-group">
              <button class="btn" id="normalCheckBtn">üîç Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="normalFeedback">Lies m und b aus dem Graphen ab.</div>
          </div>
        `;
      } else if (section === 'parallel') {
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>‚ö°</span> Parallele & Senkrechte</div>
            <div class="input-group">
              <input type="text" id="parallelM" placeholder="m‚à• (parallel)">
              <input type="text" id="parallelB" placeholder="b‚à•">
            </div>
            <div class="input-group">
              <input type="text" id="perpM" placeholder="m‚ä• (senkrecht)">
              <input type="text" id="perpB" placeholder="b‚ä•">
            </div>
            <div class="button-group">
              <button class="btn" id="parallelCheckBtn">üîç Pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="parallelFeedback">Bestimme parallele und senkrechte Gerade durch P.</div>
          </div>
        `;
      } else { // nullstellen
        const nullstelle = ex.nullstelle !== null ? ex.nullstelle.toFixed(2) : 'keine';
        exerciseHTML = `
          <div class="exercise-card">
            <div class="exercise-title"><span>‚ùå</span> Nullstellen Schritt f√ºr Schritt</div>
            <div class="input-group">
              <div class="step-row">
                <span class="step-label">1Ô∏è‚É£</span>
                <input type="text" id="step1" placeholder="f(x) = 0">
                <span class="step-hint">f(x) = 0 setzen</span>
              </div>
              <div class="step-row">
                <span class="step-label">2Ô∏è‚É£</span>
                <input type="text" id="step2" placeholder="mx + b = 0">
                <span class="step-hint">Funktion einsetzen</span>
              </div>
              <div class="step-row">
                <span class="step-label">3Ô∏è‚É£</span>
                <input type="text" id="step3" placeholder="mx = -b">
                <span class="step-hint">b auf andere Seite</span>
              </div>
              <div class="step-row">
                <span class="step-label">4Ô∏è‚É£</span>
                <input type="text" id="step4" placeholder="x = -b/m">
                <span class="step-hint">Durch m dividieren</span>
              </div>
              <div class="step-row">
                <span class="step-label">5Ô∏è‚É£</span>
                <input type="text" id="step5" placeholder="x = ...">
                <span class="step-hint">Nullstelle berechnen</span>
              </div>
            </div>
            <div class="button-group">
              <button class="btn" id="nullstellenCheckBtn">üîç Schritte pr√ºfen</button>
              <button class="btn btn-primary" id="newExampleBtn">‚ú® Neu</button>
            </div>
            <div class="feedback" id="nullstellenFeedback">
              F√ºlle jeden Umformungsschritt aus. Keinen Schritt auslassen!
            </div>
          </div>
        `;
      }

      // Komplettes Panel zusammensetzen
      panel.innerHTML = `
        <!-- Linke Spalte: Graph -->
        <div class="graph-area">
          <div class="graph-title">
            <span>${graphTitle}</span>
          </div>
          <div class="svg-container">
            ${graphSVG}
          </div>
          <div class="func-info">
            ${funcChips}
          </div>
        </div>
        <!-- Rechte Spalte: Buch + √úbung -->
        <div class="exercise-area">
          <div class="book-card">
            <h3><span>üìñ</span> Buchvorlage</h3>
            <div class="book-image">
              ${bookSVG(bookType)}
            </div>
          </div>
          ${exerciseHTML}
        </div>
      `;

      // ----- Event-Listener f√ºr Buttons (m√ºssen nach dem Rendern neu gebunden werden) -----
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.section === currentSection) btn.classList.add('active');
      });

      // Neues Beispiel
      document.querySelectorAll('#newExampleBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          currentExample = generateExample(currentSection);
          render();
        });
      });

      // Sections umschalten
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          currentSection = e.currentTarget.dataset.section;
          currentExample = generateExample(currentSection);
          render();
        });
      });

      // ----- Abschnitts-spezifische Pr√ºf-Logik -----
      if (section === 'coords') {
        const checkBtn = document.getElementById('coordsCheckBtn');
        const input = document.getElementById('coordsAnswer');
        const feedback = document.getElementById('coordsFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const val = input.value.trim();
            const parts = val.split(',').map(Number);
            if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
              const [x, y] = parts;
              if (x === ex.target.x && y === ex.target.y) {
                feedback.textContent = '‚úÖ Richtig! Punkt getroffen.';
                feedback.className = 'feedback success';
              } else {
                feedback.textContent = `‚ùå Leider falsch. Gesucht: (${ex.target.x}|${ex.target.y})`;
                feedback.className = 'feedback error';
              }
            } else {
              feedback.textContent = '‚ùå Bitte Koordinaten im Format x,y eingeben (z.B. 2,-3)';
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'table') {
        const checkBtn = document.getElementById('tableCheckBtn');
        const feedback = document.getElementById('tableFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            let allCorrect = true;
            for (let i = 0; i < ex.xs.length; i++) {
              const inp = document.getElementById(`tableInput${i}`);
              if (inp) {
                const val = parseFloat(inp.value.replace(',', '.'));
                if (isNaN(val) || Math.abs(val - ex.ys[i]) > 0.01) {
                  allCorrect = false;
                  inp.style.borderColor = '#EB5757';
                } else {
                  inp.style.borderColor = '#6FCF97';
                }
              }
            }
            if (allCorrect) {
              feedback.textContent = '‚úÖ Tabelle richtig! Super.';
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = '‚ùå Nicht alle Werte stimmen. Kontrolliere die Rechnung.';
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'normalform') {
        const checkBtn = document.getElementById('normalCheckBtn');
        const mInp = document.getElementById('normalM');
        const bInp = document.getElementById('normalB');
        const feedback = document.getElementById('normalFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const mVal = parseFloat(mInp.value.replace(',', '.'));
            const bVal = parseFloat(bInp.value.replace(',', '.'));
            if (!isNaN(mVal) && !isNaN(bVal) && Math.abs(mVal - ex.m) < 0.01 && Math.abs(bVal - ex.b) < 0.01) {
              feedback.textContent = `‚úÖ Korrekt! m = ${asFraction(ex.m)}, b = ${ex.b}`;
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = `‚ùå Falsch. Tipp: m = ${asFraction(ex.m)}, b = ${ex.b}`;
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'parallel') {
        const checkBtn = document.getElementById('parallelCheckBtn');
        const mInp = document.getElementById('parallelM');
        const bInp = document.getElementById('parallelB');
        const mPerpInp = document.getElementById('perpM');
        const bPerpInp = document.getElementById('perpB');
        const feedback = document.getElementById('parallelFeedback');
        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            const mPar = parseFloat(mInp.value.replace(',', '.'));
            const bPar = parseFloat(bInp.value.replace(',', '.'));
            const mPerp = parseFloat(mPerpInp.value.replace(',', '.'));
            const bPerp = parseFloat(bPerpInp.value.replace(',', '.'));

            let parOK = !isNaN(mPar) && !isNaN(bPar) && Math.abs(mPar - ex.m) < 0.01 && Math.abs(bPar - ex.bPar) < 0.01;
            let perpOK = !isNaN(mPerp) && !isNaN(bPerp) && Math.abs(mPerp - ex.mPerp) < 0.01 && Math.abs(bPerp - ex.bPerp) < 0.01;

            if (parOK && perpOK) {
              feedback.textContent = `‚úÖ Alles richtig! Parallel: y = ${asFraction(ex.m)}x ${ex.bPar>=0?'+':'-'} ${Math.abs(ex.bPar)} ; Senkrecht: y = ${asFraction(ex.mPerp)}x ${ex.bPerp>=0?'+':'-'} ${Math.abs(ex.bPerp)}`;
              feedback.className = 'feedback success';
            } else {
              feedback.textContent = `‚ùå Nicht korrekt. Parallel: m = ${asFraction(ex.m)}, b = ${ex.bPar}; Senkrecht: m = ${asFraction(ex.mPerp)}, b = ${ex.bPerp}`;
              feedback.className = 'feedback error';
            }
          });
        }
      }

      if (section === 'nullstellen') {
        const checkBtn = document.getElementById('nullstellenCheckBtn');
        const feedback = document.getElementById('nullstellenFeedback');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        const step5 = document.getElementById('step5');

        if (checkBtn) {
          checkBtn.addEventListener('click', () => {
            // Erwartete Werte
            const expected1 = '0';
            const expected2 = `${asFraction(ex.m)}x ${ex.b >= 0 ? '+' : '-'} ${Math.abs(ex.b)} = 0`;
            const expected3 = `${asFraction(ex.m)}x = ${-ex.b}`;
            const expected4 = `x = ${asFraction(-ex.b)} / ${asFraction(ex.m)}`;
            const expected5 = ex.nullstelle !== null ? `x = ${ex.nullstelle.toFixed(2)}` : 'keine Nullstelle';

            // Schritt 1 pr√ºfen
            const val1 = step1.value.trim();
            const step1OK = val1 === '0' || val1 === 'f(x)=0' || val1 === 'f(x) = 0';
            
            // Schritt 2 pr√ºfen (flexibel)
            const val2 = step2.value.trim().replace(/\s+/g, '');
            const expected2clean = expected2.replace(/\s+/g, '');
            const step2OK = val2 === expected2clean || val2.includes(`${asFraction(ex.m)}x`) && val2.includes('=0');
            
            // Schritt 3 pr√ºfen
            const val3 = step3.value.trim().replace(/\s+/g, '');
            const expected3clean = expected3.replace(/\s+/g, '');
            const step3OK = val3 === expected3clean || (val3.includes(`${asFraction(ex.m)}x=`) && val3.includes(`${-ex.b}`));
            
            // Schritt 4 pr√ºfen
            const val4 = step4.value.trim().replace(/\s+/g, '');
            const expected4clean = expected4.replace(/\s+/g, '');
            const step4OK = val4 === expected4clean || (val4.includes('x=') && val4.includes('/'));
            
            // Schritt 5 pr√ºfen
            const val5 = step5.value.trim();
            let step5OK = false;
            if (ex.nullstelle !== null) {
              step5OK = val5.includes(ex.nullstelle.toFixed(2)) || val5.includes(asFraction(ex.nullstelle));
            } else {
              step5OK = val5.toLowerCase().includes('keine') || val5.includes('unendlich');
            }

            // Visuelles Feedback f√ºr jeden Schritt
            step1.style.borderColor = step1OK ? '#6FCF97' : '#EB5757';
            step2.style.borderColor = step2OK ? '#6FCF97' : '#EB5757';
            step3.style.borderColor = step3OK ? '#6FCF97' : '#EB5757';
            step4.style.borderColor = step4OK ? '#6FCF97' : '#EB5757';
            step5.style.borderColor = step5OK ? '#6FCF97' : '#EB5757';

            if (step1OK && step2OK && step3OK && step4OK && step5OK) {
              feedback.textContent = `‚úÖ Alle Schritte korrekt! Nullstelle: x = ${ex.nullstelle?.toFixed(2) ?? 'keine'}`;
              feedback.className = 'feedback success';
            } else {
              const wrongSteps = [];
              if (!step1OK) wrongSteps.push('1');
              if (!step2OK) wrongSteps.push('2');
              if (!step3OK) wrongSteps.push('3');
              if (!step4OK) wrongSteps.push('4');
              if (!step5OK) wrongSteps.push('5');
              feedback.textContent = `‚ùå Schritt(e) ${wrongSteps.join(', ')} nicht korrekt. Jeden Umformungsschritt genau ausf√ºllen.`;
              feedback.className = 'feedback error';
            }
          });
        }
      }
    }

    // Initialer Render
    render();
  })();
</script>
</body>
</html>
